<!DOCTYPE html>
<html lang="en">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>U.S. Treasury Yield Curves</title>
</head>
<body>
<canvas id="canvas" style="width: 100%; height: 100%"></canvas>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script> 

const URL = "https://fred.stlouisfed.org/graph/fredgraph.csv?mode=fred&fq=Weekly"
// MATURITIES = ["1MO", "3MO", "6MO", "1", "2", "3", "5", "7", "10", "20", "30"]
const MATURITIES = ["1", "3", "5", "10"]

let ctx = document.getElementById("canvas")
let start = new Date(2019, 1, 1)
let end = new Date()
let cosd = start.toISOString().substring(0, 10)
let coed = end.toISOString().substring(0, 10)

let chart = new Chart(ctx, {
    type: "line",
    data: {
        // labels: ["1M", "3M", "6M", "1Y", "2Y", "3Y", "5Y", "7Y", "10Y", "20Y", "30Y"],
        datasets: []
    },
    options: {
        /*plugins: {
            legend: {
                display: false
            }
        },*/
        scales: {
            y: {
                min: 0,
                max: 6,
                ticks: {
                    callback: (val, idx, _) => val + "%",
                }
            }
        }
    }
})

MATURITIES.forEach(async mat => {
    
    let url = URL + "&cosd=" + cosd + "&coed=" + coed + "id=DGS" + mat
    let res = await fetch(url)
    let csv = await res.text()

    let rows = csv.split("\n").slice(1, -1).map(l => l.split(","))
    let dates = rows.map(r => r[0])
    // TODO filter rate == "."?
    let yields = rows.map(r => parseFloat(r[1]))

    chart.data.labels = dates
    chart.data.datasets.push({label: mat + "Y", data: yields})
    chart.update()
})

</script>
</body>
</html>
